syntax = "proto3";

package mws.rng;

import "data.proto";
import "msg_dump.proto";

message Msg {
  oneof msg_type {
    StoreGet storeGet = 1;
    StorePut storePut = 2;
    StoreDelete storeDelete = 3;
    BucketPut bucketPut = 4;
    DumpGetBucketData dumpGetBucketData = 5;
    GetResp getResp = 6;
    DumpPut dumpPut = 7;
    DumpGet dumpGet = 8;
    DumpBucketData dumpBucketData = 9;
    DumpEn dumpEn = 10;
    ChangeState changeState = 11;
    Saved saved = 12;
    GetBucketIfNew getBucketIfNew = 13;
    BucketUpToDate bucketUpToDate = 14;
    NewerBucketData newerBucketData = 15;
  }
}

message StoreGet {
  bytes key = 1;
}

message StorePut {
  Data data = 1;
}

message StoreDelete {
  bytes key = 1;
}

message BucketPut {
  repeated Data data = 1;
  repeated Vec bucketVc = 2;
}

message GetResp {
  repeated Data d = 1;
}

message BucketDataItem {
  bytes key = 1;
  repeated Data data = 2;
}

message ChangeState {
  int32 quorumState = 1;
}

message Saved {
}

message GetBucketVc { 
  int32 b = 1;
}

message BucketVc {
  repeated Vec vc = 1;
}

message GetBucketIfNew { 
  int32 b = 1;
  repeated Vec vc = 2;
}

message BucketUpToDate {
  int32 b = 1;
}

message NewerBucketData {
  int32 b = 1;
  repeated Vec vc = 2;
  repeated BucketDataItem items = 3;
}

message ReplFailed {
}
